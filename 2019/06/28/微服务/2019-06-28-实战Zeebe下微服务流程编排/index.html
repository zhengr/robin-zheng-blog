<!DOCTYPE html><html class="appearance-auto" lang="zh-CN"><head><meta charset="UTF-8"><title>实战Zeebe下微服务流程编排</title><meta name="description" content="观天之道，执天之行"><meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, initial-scale=1"><link rel="icon" href="/images/favicon.png"><link rel="stylesheet" href="/style/bulma.css"><link rel="stylesheet" href="/style/base.css"><link rel="stylesheet" href="/style/helper.css"><script src="/js/common.js"></script><link rel="stylesheet" href="/style/post.css"><link rel="stylesheet" href="/style/highlight-theme-light.css"><script src="/jslib/highlight.pack.js"></script><!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 5.2.0"><link rel="alternate" href="/atom.xml" title="Robin's blog" type="application/atom+xml">
</head><body class="is-flex is-flex-direction-column"><header class="is-flex header-widget is-flex-shrink-0 is-align-items-center is-justify-content-space-between is-hidden-mobile"><section class="is-hidden-mobile is-flex-shrink-0"><h2><a href="/">Robin's blog</a></h2></section><h3 class="is-hidden-mobile is-family-serif is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height" id="postTopic"><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">实战Zeebe下微服务流程编排</p><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">点击返回顶部</p></div></h3><aside class="is-flex-shrink-0"><h3 class="is-inline-block"><a href="/">首页</a></h3><h3 class="is-inline-block"><a href="/about">关于</a></h3><h3 class="is-inline-block"><a href="/archives">归档</a></h3></aside></header><header class="is-flex header-widget is-flex-shrink-0 is-align-items-center is-justify-content-center is-hidden-tablet"><h3 class="is-inline-block"><a href="/">首页</a></h3><h3 class="is-inline-block"><a href="/about">关于</a></h3><h3 class="is-inline-block"><a href="/archives">归档</a></h3></header><main><main class="container is-max-widescreen content section post-page pt-4 px-4"><div class="columns is-flex-desktop is-justify-content-center is-flex-direction-row-reverse"><div class="column is-3 is-hidden-mobile"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%86%E5%A4%87%E7%8E%AF%E5%A2%83"><span class="toc-text">准备环境</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E5%85%88%E5%85%8B%E9%9A%86Git%E4%B8%8A%E7%9A%84repository%E8%8E%B7%E5%BE%97Zeebe-Operate-in-Docker%E7%9A%84%E6%96%87%E4%BB%B6%E5%8C%85"><span class="toc-text">1.先克隆Git上的repository获得Zeebe + Operate in Docker的文件包</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E8%A7%A3%E5%8E%8B%E4%B8%8B%E8%BD%BD%E7%9A%84zeebe-docker-compose-master-zip"><span class="toc-text">2.解压下载的zeebe-docker-compose-master.zip</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-%E6%89%A7%E8%A1%8C%E5%9F%BA%E4%BA%8Edocker-compose-yml%E4%B8%8B%E8%BD%BD%E5%B9%B6%E5%88%9B%E5%BB%BA%E7%9B%B8%E5%85%B3%E7%BB%84%E4%BB%B6%E5%AE%B9%E5%99%A8"><span class="toc-text">3.执行基于docker-compose.yml下载并创建相关组件容器</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%A4%87%E6%B3%A8%EF%BC%9A"><span class="toc-text">备注：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1-%E7%AB%AF%E5%8F%A3"><span class="toc-text">服务 &#x2F; 端口</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-%E6%A3%80%E6%9F%A5%E6%9C%8D%E5%8A%A1%E7%8A%B6%E6%80%81"><span class="toc-text">4.检查服务状态</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B5%81%E7%A8%8B%E9%83%A8%E7%BD%B2"><span class="toc-text">流程部署</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%B5%81%E7%A8%8B%E5%AE%9E%E4%BE%8B"><span class="toc-text">创建流程实例</span></a></li></ol></div><div class="column is-9"><header class="my-4"><a href="/tags/Oracle"><i class="tag post-item-tag">Oracle</i></a><a href="/tags/%E6%B5%81%E7%A8%8B%E7%BC%96%E6%8E%92"><i class="tag post-item-tag">流程编排</i></a><a href="/tags/Zeebe"><i class="tag post-item-tag">Zeebe</i></a></header><h1 class="mt-0 mb-1 is-family-serif" id="postTitle">实战Zeebe下微服务流程编排</h1><time class="has-text-grey" datetime="2019-06-28T00:00:00.000Z">2019-06-28</time><article class="mt-2 post-content"><p>构建Zeebe作为下一代工作流引擎，用于新兴用例，例如微服务编排用例，这些用例可能需要引擎每秒处理数十万（或数百万）个新工作流实例。为此，我们使用的图形建模标准已经存在了近15年：BPMN（业务流程模型和表示法）。可以预见，未来微服务编排将会是中台服务化最有力的落地工具之一。</p>
<p>借这个机会和大家分享一下基本的Zeebe部署和一个简单的范例。</p>
<h2 id="准备环境"><a href="#准备环境" class="headerlink" title="准备环境"></a>准备环境</h2><h5 id="1-先克隆Git上的repository获得Zeebe-Operate-in-Docker的文件包"><a href="#1-先克隆Git上的repository获得Zeebe-Operate-in-Docker的文件包" class="headerlink" title="1.先克隆Git上的repository获得Zeebe + Operate in Docker的文件包"></a>1.先克隆Git上的repository获得Zeebe + Operate in Docker的文件包</h5><pre><code>git clone https://github.com/zeebe-io/zeebe-docker-compose</code></pre>
<h5 id="2-解压下载的zeebe-docker-compose-master-zip"><a href="#2-解压下载的zeebe-docker-compose-master-zip" class="headerlink" title="2.解压下载的zeebe-docker-compose-master.zip"></a>2.解压下载的zeebe-docker-compose-master.zip</h5><h5 id="3-执行基于docker-compose-yml下载并创建相关组件容器"><a href="#3-执行基于docker-compose-yml下载并创建相关组件容器" class="headerlink" title="3.执行基于docker-compose.yml下载并创建相关组件容器"></a>3.执行基于docker-compose.yml下载并创建相关组件容器</h5><pre><code># change to directory of the profile to start, i.e
# cd operate/
docker-compose up</code></pre>
<blockquote>
<p>备注： docker-compose down 用来shutdown容器</p>
</blockquote>
<p>例如：</p>
<pre><code class="shell">(base) MacBookPro:operate zhengr$ docker-compose up

Pulling operate (camunda/operate:1.0.0-alpha11)...

1.0.0-alpha11: Pulling from camunda/operate

6f2f362378c5: Pull complete

494c27a8a6b8: Pull complete

7596bb83081b: Pull complete

1e739bce2743: Pull complete

4dde2a90460d: Pull complete

1f5b8585072c: Pull complete

883cfe76ed71: Pull complete

c025c61085ef: Pull complete

b060cd7d08ce: Pull complete

93da9e8063ec: Pull complete

Pulling elasticsearch (docker.elastic.co/elasticsearch/elasticsearch-oss:6.7.1)...

6.7.1: Pulling from elasticsearch/elasticsearch-oss

8ba884070f61: Pull complete

2202e0dee1cc: Pull complete

046487a6b47b: Pull complete

2bf203bafcf4: Pull complete

ecabf552c89a: Pull complete

93123b7bf511: Pull complete

2867102d5376: Pull complete

Pulling zeebe (camunda/zeebe:0.18.0)...

0.18.0: Pulling from camunda/zeebe

de8cd8ac2c2a: Pull complete

62def3ffad8c: Pull complete

1dafe0169f91: Pull complete

f4521a1bc960: Pull complete

0c2a2533a883: Pull complete

dfd212cc6b74: Pull complete

65e222ddee27: Pull complete

ce1bf1781edd: Pull complete

4c631900e34b: Pull complete

55bebb03879a: Pull complete

6b22452bf891: Pull complete

8e4a1a2f6114: Pull complete

Pulling kibana (docker.elastic.co/kibana/kibana-oss:6.7.1)...

6.7.1: Pulling from kibana/kibana-oss

8ba884070f61: Already exists

9de755da2607: Pull complete

a530113b5366: Pull complete

fcc058e5c07b: Pull complete

b01d58af14f6: Pull complete

74a53cb7bf61: Pull complete

12a05e912a4b: Pull complete

94203c8a1395: Pull complete

Creating operate_kibana_1        ... done

Creating operate_elasticsearch_1 ... done

Creating operate_operate_1       ... done

Creating operate_zeebe_1         ... done

Attaching to operate_kibana_1, operate_operate_1, operate_elasticsearch_1, operate_zeebe_1</code></pre>
<blockquote>
<h5 id="备注："><a href="#备注：" class="headerlink" title="备注："></a>备注：</h5><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/zhengr/zeebe-docker-compose/blob/master/bin"><code>bin/zbctl*</code></a> - cli binary to interact with the broker</li>
</ul>
<h5 id="服务-端口"><a href="#服务-端口" class="headerlink" title="服务 / 端口"></a>服务 / 端口</h5><p>我们启动的docker容器将提供如下服务:</p>
<ul>
<li>Zeebe broker - port 26500</li>
<li>Operate - web interface <a target="_blank" rel="noopener" href="http://localhost:8080/">http://localhost:8080</a> (login: demo/demo)</li>
<li>ElasticSearch - port <a target="_blank" rel="noopener" href="https://localhost:9200/">https://localhost:9200</a></li>
<li>Kibana - port <a target="_blank" rel="noopener" href="https://localhost:5601/">https://localhost:5601</a></li>
<li>Simple Monitor - web interface <a target="_blank" rel="noopener" href="http://localhost:8082/">http://localhost:8082</a></li>
</ul>
</blockquote>
<h5 id="4-检查服务状态"><a href="#4-检查服务状态" class="headerlink" title="4.检查服务状态"></a>4.检查服务状态</h5><pre><code>(base) MacBookPro:bin zhengr$ ./zbctl.darwin status

Cluster size: 1

Partitions count: 1

Replication factor: 1

Brokers:

  Broker 0 - 172.18.0.5:26501

​    Partition 1 : Leader</code></pre>
<p>以上容器部署完成后， Zeebe的服务框架就准备好了，接下来我们做范例流程部署。</p>
<h2 id="流程部署"><a href="#流程部署" class="headerlink" title="流程部署"></a>流程部署</h2><p>The <code>zbctl</code> binary is included to allow you to interact with the running broker. The binary is named:</p>
<table>
<thead>
<tr>
<th>Operating System</th>
<th>zbctl binary</th>
</tr>
</thead>
<tbody><tr>
<td>Linux</td>
<td>bin/zbctl</td>
</tr>
<tr>
<td>OS X</td>
<td>bin/zbctl.darwin</td>
</tr>
<tr>
<td>Windows</td>
<td>bin/zbctl.exe</td>
</tr>
</tbody></table>
<pre><code>cd zeebe-docker-compose
bin/zbctl deploy ../path/to/your-file.bpmn</code></pre>
<p>这里我们用一个已经制作完成的BPMN文件部署测试。<strong>order-process.bpmn</strong></p>
<p><img src="https://raw.githubusercontent.com/zhengr/zhengr.github.io/master/assets/images/order-process.png" alt="order-process"></p>
<p>这个order-process.bpmn可以用<a target="_blank" rel="noopener" href="https://github.com/zeebe-io/zeebe-modeler/releases">zeebe Modeler</a>可视化编排</p>
<p><img src="https://raw.githubusercontent.com/zhengr/zhengr.github.io/master/assets/images/image-20190628115030145.png" alt="image-20190628115030145"></p>
<pre><code>(base) MacBookPro:bin zhengr$ ./zbctl.darwin deploy order-process.bpmn
&#123;
  &quot;key&quot;: 2251799813685259,
  &quot;workflows&quot;: [
    &#123;
      &quot;bpmnProcessId&quot;: &quot;order-process&quot;,
      &quot;version&quot;: 1,
      &quot;workflowKey&quot;: 2251799813685251,
      &quot;resourceName&quot;: &quot;order-process.bpmn&quot;
    &#125;
  ]
&#125;</code></pre>
<h2 id="创建流程实例"><a href="#创建流程实例" class="headerlink" title="创建流程实例"></a>创建流程实例</h2><pre><code>./bin/zbctl create instance order-process --variables &#39;&#123;&quot;orderId&quot;: XXX&#125;&#39;</code></pre>
<p>例如：</p>
<pre><code class="shell">(base) MacBookPro:bin zhengr$ ./zbctl.darwin create instance order-process --variables &#39;&#123;&quot;orderId&quot;: 45678&#125;&#39;

&#123;

  &quot;workflowKey&quot;: 2251799813685258,

  &quot;bpmnProcessId&quot;: &quot;order-process&quot;,

  &quot;version&quot;: 2,

  &quot;workflowInstanceKey&quot;: 2251799813685260

&#125;</code></pre>
<p>打开 <a target="_blank" rel="noopener" href="http://localhost:8080/">http://localhost:8080</a> 通过Operate检查部署实例情况：</p>
<p><img src="https://raw.githubusercontent.com/zhengr/zhengr.github.io/master/assets/images/Jietu20190628-122341.jpg" alt="Jietu20190628-122341"></p>
<p><img src="https://raw.githubusercontent.com/zhengr/zhengr.github.io/master/assets/images/image-20190628120128229.png" alt="image-20190628120128229"></p>
</article><section class="jump-container is-flex is-justify-content-space-between my-6"><!-- em is empty placeholder--><a class="button is-default" href="/2019/08/20/%E5%90%8E%E7%AB%AF/jpa/Fenix%20%E2%80%94%20%E6%AF%94%20MyBatis%20%E6%9B%B4%E5%8A%A0%E5%BC%BA%E5%A4%A7%E7%9A%84%20Spring%20Data%20JPA%20%E6%89%A9%E5%B1%95%E5%BA%93/" title="Fenix — 比 MyBatis 更加强大的 Spring Data JPA 扩展库"><i class="iconfont icon-prev mr-2 has-text-grey"></i><span class="has-text-weight-semibold">上一页: Fenix — 比 MyBatis 更加强大的 Spring Data JPA 扩展库</span></a><a class="button is-default" href="/2019/02/15/AI/2019-02-15-%E5%88%A9%E7%94%A8KNIME%20Deeplearning4J%20Integration%E5%88%86%E6%9E%90%E5%90%B4%E7%A7%80%E6%B3%A2%E4%BA%8B%E4%BB%B6%E5%A5%B3%E4%B8%BBCici/" title="利用KNIME Deeplearning4J Integration分析吴秀波事件女主cici"><span class="has-text-weight-semibold">下一页: 利用KNIME Deeplearning4J Integration分析吴秀波事件女主cici</span><i class="iconfont icon-next ml-2 has-text-grey"></i></a></section><article class="mt-6 comment-container"><script async repo="zhengr/Claudia-theme-blog" src="https://utteranc.es/client.js" issue-term="pathname" theme="preferred-color-scheme"></script></article></div></div></main></main><footer class="is-flex is-flex-direction-column is-align-items-center is-flex-shrink-0 is-family-serif"><section class="sns-container"><a title="twitter" target="_blank" rel="noopener nofollow" href="//twitter.com//"><i class="iconfont icon-twitter"></i></a><!-- Github--><a title="github" target="_blank" rel="noopener nofollow" href="//github.com/zhengr"><i class="iconfont icon-github"></i></a><!-- Ins--><a title="instagram" target="_blank" rel="noopener nofollow" href="//www.instagram.com//"><i class="iconfont icon-ins"></i></a><!-- RSS--><a title="rss" target="_blank" rel="noopener nofollow" href="/atom.xml"><i class="iconfont icon-rss"></i></a><!-- 知乎--><!-- 领英--><!-- 脸书--><a title="facebook" target="_blank" rel="noopener nofollow" href="//www.facebook.com//"><i class="iconfont icon-tian7_facebook"></i></a></section><p><span>Copyright ©</span><span> Robin 2021</span></p></footer><script async defer src="https://buttons.github.io/buttons.js"></script><script src="/js/post.js"></script></body></html>